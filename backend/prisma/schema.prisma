generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  CLIENT
  THERAPIST
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model User {
  id            Int       @id @default(autoincrement())
  name          String    @db.VarChar(100)
  email         String    @unique @db.VarChar(100)
  password      String    @db.VarChar(255)
  role          Role      @default(CLIENT)
  refereshtoken String?   @db.VarChar(100)
  appointment   Appointment[] @relation("ClientAppointments")

  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updatedat     DateTime? @updatedAt
}

model Therapist {
  user_id       Int         @id
  bio           String
  experience    Int
  services      Service[]
  available     Availability[]
  user          User     @relation(fields: [user_id], references: [id])

  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updatedat     DateTime? @updatedAt
}

model Service {
  id            Int     @id @default(autoincrement())
  name          String
  desc          String
  duration      Int     @default(30)
  price         Int     @default(15)
  is_active     Boolean @default(true)
  therapist_id    Int
  therapist     Therapist @relation(fields: [therapist_id], references: [user_id])

  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updatedat     DateTime? @updatedAt
}

model Availability {
  id            Int       @id @default(autoincrement())
  day_of_week   Int
  start_time    Int
  end_time      Int
  is_available  Boolean   @default(true)
  therapist_id  Int

  therapist     Therapist @relation(fields: [therapist_id], references: [user_id])

  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updatedat     DateTime? @updatedAt

  @@index([therapist_id])
  @@unique([therapist_id, day_of_week, start_time, end_time])
}

model Appointment {
  id            Int       @id @default(autoincrement())
  status        AppointmentStatus    @default(PENDING)
  service       Service   @relation(fields: [service_id], references: [id])
  service_id    Int
  availability_id Int?
  availability  Availability? relation(fields: [availability_id], references: [id])
  client_id     Int
  client        User      @relation("ClientAppointments", fields: [client_id], references: [id])
  start_time    Int
  end_time      Int

  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updatedat     DateTime? @updatedAt
  @@index([client_id])
  @@index([therapist_id])
  @@index([start_time])
  @@unique([therapist_id, start_time, end_time])
}

model Event {
  id            Int       @id @default(autoincrement())
  title         String
  desc          String
  price         Int
  capacity      Int
  location      String
  start_time    Int
  end_time      Int

  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updatedat     DateTime? @updatedAt
}

model EventAttendee {
  user_id  Int
  event_id Int

  user  User  @relation(fields: [user_id], references: [id])
  event Event @relation(fields: [event_id], references: [id])

  @@id([user_id, event_id])
}
